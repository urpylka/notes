<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><meta property="og:site_name" content="urpylka՚s blog!" data-vmid="og:site_name"><title>Работа с файловой системой Linux – urpylka՚s blog!</title><meta property="og:title" content="Работа с файловой системой Linux" />
<meta property="og:description" content="Немного заметок по работе с блочными устройствами и файловой системой на Linux." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://urpylka.com/posts/post-51/" />
<meta property="article:published_time" content="2020-04-16T02:14:00+04:00" />
<meta property="article:modified_time" content="2020-04-16T02:14:00+04:00" /><meta property="og:site_name" content="urpylka՚s blog!" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Работа с файловой системой Linux"/>
<meta name="twitter:description" content="Немного заметок по работе с блочными устройствами и файловой системой на Linux."/>
<link rel="icon" type="image/x-icon" href="https://urpylka.com/favicon.ico" />
	<link rel="apple-touch-icon" sizes="57x57" href="https://urpylka.com/favicon/apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="https://urpylka.com/favicon/apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="https://urpylka.com/favicon/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="https://urpylka.com/favicon/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="https://urpylka.com/favicon/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="https://urpylka.com/favicon/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="https://urpylka.com/favicon/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="https://urpylka.com/favicon/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="https://urpylka.com/favicon/apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192"  href="https://urpylka.com/favicon/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://urpylka.com/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="https://urpylka.com/favicon/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://urpylka.com/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://urpylka.com/favicon/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="https://urpylka.com/favicon/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1"><meta itemprop="name" content="Работа с файловой системой Linux">
<meta itemprop="description" content="Немного заметок по работе с блочными устройствами и файловой системой на Linux.">
<meta itemprop="datePublished" content="2020-04-16T02:14:00&#43;04:00" />
<meta itemprop="dateModified" content="2020-04-16T02:14:00&#43;04:00" />
<meta itemprop="wordCount" content="374">



<meta itemprop="keywords" content="ru,programming,cheatsheet," /><link rel="stylesheet" type="text/css" media="screen" href="https://urpylka.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://urpylka.com/css/main.css" />
	<link rel="stylesheet" type="text/css" id="dark-scheme" href="https://urpylka.com/css/dark.css" />
	<link rel="stylesheet" type="text/css" href="https://urpylka.com/css/medium-font.css" />
<script type="text/javascript" >
	(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
	m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
	(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
ym("62022457", "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/62022457" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-163829261-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	<script src="https://urpylka.com/js/feather.min.js"></script><script src="https://urpylka.com/js/main.js"></script></head>


<body>
    <div class="container wrapper">
        <div class="header"><div class="flex-block">
		<div class="site-title"><a href="https://urpylka.com/">urpylka՚s blog!</a></div>
		<nav class="nav ico">
			<ul class="flat"><li><a href="https://github.com/urpylka" title="Github"><i data-feather="github"></i></a></li><li><a href="https://instagram.com/urpylka" title="Instagram"><i data-feather="instagram"></i></a></li><li class="edge-left"><span class="scheme-toggle"><a href="#" id="scheme-toggle"></a></span></li>
			</ul>
		</nav>
	</div><p id="subtitle">Programming, robotics, traveling</p><nav class="nav menu">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">Posts</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


        <div class="post one">
            <div class="post-header">
                
                <div class="meta">
                    <div class="date">
                        <span class="day">16</span>
                        <span class="rest">Apr 2020</span>
                    </div>
                </div>
                
                <div class="matter">
                    <h1 class="title">Работа с файловой системой Linux</h1>
                </div>
            </div>

            <div class="markdown">
                <h2 id="что-такое-uuid--partuuid">Что такое UUID / PARTUUID</h2>
<p>Как видно из скриншота ниже, в ОС для удобства обращения к блочным устройствам автоматически создаются различные симлинки.</p>
<p><img src="./images/screenshot-2018-02-02-at-12.37.59.png" alt="image"></p>
<p><strong>UUID</strong> задается при форматировании файловой системы и хранится в её суперблоке. Поэтому при побайтовом копировании разделов <code>UUID</code> не меняется.</p>
<p>При подключении нескольких блочных устройств с одинаковыми <code>UUID</code>, в <code>/dev/disk/by-uuid</code> отображается только последнее подключенное устройство. Подробнее <a href="http://rus-linux.net/nlib.php?name=/MyLDP/hard/izmenenie-uuid-i-metki-toma-na-diske.html">rus-linux.net</a>.</p>
<p><strong>PARTUUID</strong> также не меняется при побайтовом копировании. А также не меняется при ручном изменении размера файловой системы. Однако, как пример, в Raspberry Pi при первом запуске системы вызывается <code>raspi-config</code> для расширения <code>rootfs</code> раздела до максимально возможного. При её исполнении меняется <code>partuuid</code>, а также меняется <code>partuuid</code> указанный в <code>/boot/cmdline.txt</code>).</p>
<p>Подробнее о разнице <code>UUID</code> и <code>PARTUUID</code> здесь <a href="https://raspberrypi.stackexchange.com/questions/75027/whats-the-difference-between-uuid-and-partuuid">raspberrypi.stackexchange.com</a>.</p>
<h2 id="raspberry-pi-and-bootcmdlinetxt">Raspberry Pi and /boot/cmdline.txt</h2>
<p>Файл <code>/boot/cmdline.txt</code> содержит сроку аргументов для загрузчика. В параметре &ldquo;root&rdquo; указывается путь к разделу <code>rootfs</code>.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">dwc_otg.lpm_enable=0 console=serial0,115200 console=tty1 root=PARTUUID=7d8d8169-02 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait
</code></pre></div><p>Вместо указания конкретного <code>PARTUUID</code> (например <code>root=PARTUUID=37665771-02</code>), можно использовать <code>root=/dev/sda2</code>.</p>
<p>Не работают следующие варианты:</p>
<ul>
<li><code>root=UUID=&lt;валиндый UUID как в /dev/disk/by-uuid/\*&gt;</code></li>
<li><code>root=PATH=&lt;валидный путь как в /dev/disk/by-path/\*&gt;</code></li>
<li><code>root=/dev/disk/by-path/&lt;валидный идентификатор пути&gt;</code></li>
</ul>
<hr>
<blockquote>
<p>В <code>raspi-config</code> жестко прописаны <code>/dev/mmcblk0</code> и <code>/dev/mmcblk0p2</code>, поэтому, чтобы сделать resize с помощью этой утилиты на usb-флешкарте нужно заменить эти строки на пути mountpoint'ам usb-флешки, например на <code>/dev/sda</code> и <code>/dev/sda2</code>.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cp /usr/bin/raspi-config ~
sed -i <span style="color:#a31515">&#39;s/mmcblk0p/sda/&#39;</span> ~/raspi-config
sed -i <span style="color:#a31515">&#39;s/mmcblk0/sda/&#39;</span> ~/raspi-config
sudo ~/raspi-config
</code></pre></div></blockquote>
<h2 id="работа-с-dd">Работа с dd</h2>
<p>Для копирования ОС можно воспользоваться утилитой <code>dd</code>. Она умеет побайтово копировать. Она работает с абстракцией файла, поэтому может производить копирование блочных устройств в файлы и наоборот совершенно прозрачно.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo dd status=progress <span style="color:#00f">if</span>=/dev/mmcblk0 of=&lt;filename.img&gt; bs=100M count=3065
</code></pre></div><ul>
<li><code>if</code> – устройство источник</li>
<li><code>of</code> – устройство получатель</li>
<li><code>bs</code> – размер чанка для копирования</li>
<li><code>count</code> – количество чанков для копирования (можно указат чуть больше)</li>
<li><code>status</code> – вывод в терминал статуса копирования. В некоторых пакетах <code>dd</code> не предусмотрен показ статус, тогда для этого можно воспользоваться утилитой <code>pv</code>. Подробнее на <a href="https://askubuntu.com/questions/215505/how-do-you-monitor-the-progress-of-dd">askubuntu.com</a>.</li>
</ul>
<p>Также у этой утилиты есть и другие параметры, например параметр смещения <code>seek</code>.</p>
<h2 id="работа-с-блочными-устройствами">Работа с блочными устройствами</h2>
<p><strong>Форматирование фaйловой системы mkfs</strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo mkfs -t ext4 -L root /dev/sda6

mkfs [options] [-t &lt;type&gt;] [fs-options] &lt;device&gt; [&lt;size&gt;]
</code></pre></div><p><strong>Резервирование места на диске</strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo tune2fs -m1 /dev/mmcblk0p2
tune2fs 1.43.4 (31-Jan-2017)
Setting reserved blocks percentage to 1% (19287 blocks)
</code></pre></div><p><strong>Источники</strong></p>
<ul>
<li>Хорошая статья про работу с файловой системой <a href="https://losst.ru/rabota-s-fajlovoj-sistemoj-linux">losst.ru</a></li>
<li><a href="http://wikihandbk.com/wiki/Raspberry_Pi:%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0/%D0%9A%D0%B0%D0%BA_%D0%BF%D0%B5%D1%80%D0%B5%D0%BD%D0%B5%D1%81%D1%82%D0%B8_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%D1%83%D1%8E_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%83_%D0%BD%D0%B0_USB-%D1%84%D0%BB%D1%8D%D1%88%D0%BA%D1%83">wikihandbk.com</a></li>
<li>Parted (аля fdisk) <a href="http://wiki.dieg.info/parted">wiki.dieg.info</a></li>
<li>управление дисками с gparted <a href="https://losst.ru/formatirovanie-diska-v-linux">losst.ru</a></li>
<li>Удаление разделов с parted <a href="https://www.stableit.ru/2010/09/blog-post_06.html">stableit.ru</a></li>
</ul>

            </div>

            <div class="tags">
                 
                <ul class="flat">
                    
                    <li><a href="/tags/ru">ru</a></li>
                    
                    <li><a href="/tags/programming">programming</a></li>
                    
                    <li><a href="/tags/cheatsheet">cheatsheet</a></li>
                    
                </ul>
                 
            </div>

<br/>
<script defer src="https://commento.urpylka.com/js/commento.js" data-css-override="/css/commento.css"></script>
<div id="commento"></div>
<noscript>Please enable JavaScript to load the comments.</noscript></div>
    </div>
    <div class="footer wrapper">
	<nav class="nav">
		<div>2020  © Artem Smirnov |  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div><script>feather.replace()</script>
</body>

</html>