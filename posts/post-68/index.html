<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><meta property="og:site_name" content="urpylka՚s blog!" data-vmid="og:site_name"><title>Searching lost metrics after updating kube-state-metrics – urpylka՚s blog!</title><meta property="og:title" content="Searching lost metrics after updating kube-state-metrics" />
<meta property="og:description" content="After updating at my work Kubernetes cluster and updating Prometheus Operator, was updated its component – kube-state-metrics to 2.3.0. Early when vesrions were used 1.4.0 and 1.7.0, there is no problem because it is back compitable. But since 2.0.0 was deleted some metric. And I need to discover this, because some of them was used in alerts!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://urpylka.com/posts/post-68/" />
<meta property="article:published_time" content="2022-02-24T18:40:00+02:00" />
<meta property="article:modified_time" content="2022-02-24T18:40:00+02:00" /><meta property="og:site_name" content="urpylka՚s blog!" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Searching lost metrics after updating kube-state-metrics"/>
<meta name="twitter:description" content="After updating at my work Kubernetes cluster and updating Prometheus Operator, was updated its component – kube-state-metrics to 2.3.0. Early when vesrions were used 1.4.0 and 1.7.0, there is no problem because it is back compitable. But since 2.0.0 was deleted some metric. And I need to discover this, because some of them was used in alerts!"/>
<link rel="icon" type="image/x-icon" href="https://urpylka.com/favicon.ico" />
	<link rel="apple-touch-icon" sizes="57x57" href="https://urpylka.com/favicon/apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="https://urpylka.com/favicon/apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="https://urpylka.com/favicon/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="https://urpylka.com/favicon/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="https://urpylka.com/favicon/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="https://urpylka.com/favicon/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="https://urpylka.com/favicon/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="https://urpylka.com/favicon/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="https://urpylka.com/favicon/apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192"  href="https://urpylka.com/favicon/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://urpylka.com/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="https://urpylka.com/favicon/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://urpylka.com/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://urpylka.com/favicon/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="https://urpylka.com/favicon/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1"><meta itemprop="name" content="Searching lost metrics after updating kube-state-metrics">
<meta itemprop="description" content="After updating at my work Kubernetes cluster and updating Prometheus Operator, was updated its component – kube-state-metrics to 2.3.0. Early when vesrions were used 1.4.0 and 1.7.0, there is no problem because it is back compitable. But since 2.0.0 was deleted some metric. And I need to discover this, because some of them was used in alerts!">
<meta itemprop="datePublished" content="2022-02-24T18:40:00&#43;02:00" />
<meta itemprop="dateModified" content="2022-02-24T18:40:00&#43;02:00" />
<meta itemprop="wordCount" content="659">



<meta itemprop="keywords" content="en,programming,metrics," /><link rel="stylesheet" type="text/css" media="screen" href="https://urpylka.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://urpylka.com/css/main.css" />
	<link rel="stylesheet" type="text/css" id="dark-scheme" href="https://urpylka.com/css/dark.css" />
	<link rel="stylesheet" type="text/css" href="https://urpylka.com/css/medium-font.css" />
<script type="text/javascript" >
	(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
	m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
	(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
ym("62022457", "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/62022457" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-163829261-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	<script src="https://urpylka.com/js/feather.min.js"></script><script src="https://urpylka.com/js/main.js"></script></head>


<body>
    <div class="container wrapper">
        <div class="header"><div class="flex-block">
		<div class="site-title"><a href="https://urpylka.com/">urpylka՚s blog!</a></div>
		<nav class="nav ico">
			<ul class="flat"><li><a href="https://github.com/urpylka" title="Github"><i data-feather="github"></i></a></li><li><a href="https://instagram.com/urpylka" title="Instagram"><i data-feather="instagram"></i></a></li><li class="edge-left"><span class="scheme-toggle"><a href="#" id="scheme-toggle"></a></span></li>
			</ul>
		</nav>
	</div><p id="subtitle">Programming, robotics, traveling</p><nav class="nav menu">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">Posts</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


        <div class="post one">
            <div class="post-header">
                
                <div class="meta">
                    <div class="date">
                        <span class="day">24</span>
                        <span class="rest">Feb 2022</span>
                    </div>
                </div>
                
                <div class="matter">
                    <h1 class="title">Searching lost metrics after updating kube-state-metrics</h1>
                </div>
            </div>

            <div class="markdown">
                <p>After updating at my work Kubernetes cluster and updating Prometheus Operator, was updated its component – <a href="https://github.com/kubernetes/kube-state-metrics">kube-state-metrics</a> to <code>2.3.0</code>. Early when vesrions were used <code>1.4.0</code> and <code>1.7.0</code>, there is no problem because it is back compitable. But since <code>2.0.0</code> was deleted some metric. And I need to discover this, because some of them was used in alerts!</p>
<p>For that I wrote 3 scripts:</p>
<h2 id="get-140-metrics">Get 1.4.0 metrics</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#00f">#! /bin/bash
</span><span style="color:#00f"></span>
PATH_TO_CODE=<span style="color:#a31515">&#34;./pkg/collectors&#34;</span>
WORD_TO_FIND=<span style="color:#a31515">&#34;prometheus.NewDesc(&#34;</span>

<span style="color:#00f">for</span> file in <span style="color:#a31515">`</span>find <span style="color:#a31515">${</span>PATH_TO_CODE<span style="color:#a31515">}</span> -type f -name <span style="color:#a31515">&#34;*.go&#34;</span> -not -path <span style="color:#a31515">&#34;*_test*&#34;</span><span style="color:#a31515">`</span>; <span style="color:#00f">do</span>
    list=<span style="color:#00f">$(</span>cat $file | grep -n <span style="color:#a31515">&#34;</span><span style="color:#a31515">${</span>WORD_TO_FIND<span style="color:#a31515">}</span><span style="color:#a31515">&#34;</span> | awk -F<span style="color:#a31515">&#39;:&#39;</span> <span style="color:#a31515">&#39;{print $1+1}&#39;</span><span style="color:#00f">)</span>

    <span style="color:#00f">if</span> [ ! -z <span style="color:#a31515">&#34;</span>$list<span style="color:#a31515">&#34;</span> ]; <span style="color:#00f">then</span>
        echo -e <span style="color:#a31515">&#34;\n</span>$file<span style="color:#a31515">&#34;</span> | sed <span style="color:#a31515">&#39;s/pkg\/collectors/internal\/store/&#39;</span>
        new_list=()
        <span style="color:#00f">for</span> line in <span style="color:#00f">$(</span>echo $list<span style="color:#00f">)</span>; <span style="color:#00f">do</span>
            metric=<span style="color:#00f">$(</span>cat $file | awk <span style="color:#a31515">&#34;(NR == </span>$line<span style="color:#a31515">)&#34;</span> | xargs echo | awk -F <span style="color:#a31515">&#39;,&#39;</span> <span style="color:#a31515">&#39;{print $1}&#39;</span><span style="color:#00f">)</span>
            <span style="color:#00f">if</span> [[ <span style="color:#a31515">&#34;</span>$metric<span style="color:#a31515">&#34;</span> =~ <span style="color:#a31515">&#34;desc&#34;</span> ]]; <span style="color:#00f">then</span>
                metric=<span style="color:#00f">$(</span>cat $file | grep <span style="color:#a31515">&#34;</span>$metric<span style="color:#a31515">.*=&#34;</span> | awk -F <span style="color:#a31515">&#34;=&#34;</span> <span style="color:#a31515">&#39;{print $2}&#39;</span> | xargs echo<span style="color:#00f">)</span>
            <span style="color:#00f">fi</span>
            new_list+=($metric)
        <span style="color:#00f">done</span>
        IFS=<span style="color:#a31515">$&#39;\n&#39;</span> sorted=(<span style="color:#00f">$(</span>sort -u &lt;&lt;&lt;<span style="color:#a31515">&#34;</span><span style="color:#a31515">${</span>new_list[*]<span style="color:#a31515">}</span><span style="color:#a31515">&#34;</span><span style="color:#00f">)</span>); unset IFS

        <span style="color:#00f">for</span> i in <span style="color:#a31515">${</span>sorted[@]<span style="color:#a31515">}</span>; <span style="color:#00f">do</span> echo $i; <span style="color:#00f">done</span>
    <span style="color:#00f">fi</span>
<span style="color:#00f">done</span>
</code></pre></div><p>Download metrics you can <a href="./ksm_140.txt">here</a>.</p>
<h2 id="get-170-metrics">Get 1.7.0 metrics</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#00f">#! /bin/bash
</span><span style="color:#00f"></span>
PATH_TO_CODE=<span style="color:#a31515">&#34;./internal/store&#34;</span>
WORD_TO_FIND=<span style="color:#a31515">&#34;			Name: &#34;</span>

<span style="color:#00f">for</span> file in <span style="color:#a31515">`</span>find <span style="color:#a31515">${</span>PATH_TO_CODE<span style="color:#a31515">}</span> -type f -name <span style="color:#a31515">&#34;*.go&#34;</span> -not -path <span style="color:#a31515">&#34;*_test*&#34;</span><span style="color:#a31515">`</span>; <span style="color:#00f">do</span>
    list=<span style="color:#00f">$(</span>cat $file | grep -n <span style="color:#a31515">&#34;</span><span style="color:#a31515">${</span>WORD_TO_FIND<span style="color:#a31515">}</span><span style="color:#a31515">&#34;</span> | awk -F<span style="color:#a31515">&#39;:&#39;</span> <span style="color:#a31515">&#39;{print $1}&#39;</span><span style="color:#00f">)</span>


    <span style="color:#00f">if</span> [ ! -z <span style="color:#a31515">&#34;</span>$list<span style="color:#a31515">&#34;</span> ]; <span style="color:#00f">then</span>
        echo -e <span style="color:#a31515">&#34;\n</span>$file<span style="color:#a31515">&#34;</span>
        new_list=()
        <span style="color:#00f">for</span> line in <span style="color:#00f">$(</span>echo $list<span style="color:#00f">)</span>; <span style="color:#00f">do</span>
            metric=<span style="color:#00f">$(</span>cat $file | awk <span style="color:#a31515">&#34;(NR == </span>$line<span style="color:#a31515">)&#34;</span> | xargs echo | awk -F <span style="color:#a31515">&#39;,&#39;</span> <span style="color:#a31515">&#39;{print $1}&#39;</span> | awk -F <span style="color:#a31515">&#34;: &#34;</span> <span style="color:#a31515">&#39;{print $2}&#39;</span><span style="color:#00f">)</span>
            <span style="color:#00f">if</span> [[ <span style="color:#a31515">&#34;</span>$metric<span style="color:#a31515">&#34;</span> =~ <span style="color:#a31515">&#34;desc&#34;</span> ]]; <span style="color:#00f">then</span>
                metric=<span style="color:#00f">$(</span>cat $file | grep <span style="color:#a31515">&#34;</span>$metric<span style="color:#a31515">.*=&#34;</span> | awk -F <span style="color:#a31515">&#34;=&#34;</span> <span style="color:#a31515">&#39;{print $2}&#39;</span> | xargs echo<span style="color:#00f">)</span>
            <span style="color:#00f">fi</span>
            new_list+=($metric)
        <span style="color:#00f">done</span>
        IFS=<span style="color:#a31515">$&#39;\n&#39;</span> sorted=(<span style="color:#00f">$(</span>sort -u &lt;&lt;&lt;<span style="color:#a31515">&#34;</span><span style="color:#a31515">${</span>new_list[*]<span style="color:#a31515">}</span><span style="color:#a31515">&#34;</span><span style="color:#00f">)</span>); unset IFS
        <span style="color:#00f">for</span> i in <span style="color:#a31515">${</span>sorted[@]<span style="color:#a31515">}</span>; <span style="color:#00f">do</span> echo $i; <span style="color:#00f">done</span>
    <span style="color:#00f">fi</span>
<span style="color:#00f">done</span>
</code></pre></div><p>Download metrics you can <a href="./ksm_170.txt">here</a>.</p>
<h2 id="get-230-metrics">Get 2.3.0 metrics</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#00f">#! /bin/bash
</span><span style="color:#00f"></span>
PATH_TO_CODE=<span style="color:#a31515">&#34;./internal/store&#34;</span>
WORD_TO_FIND=<span style="color:#a31515">&#34;*generator.NewFamilyGenerator(&#34;</span>

<span style="color:#00f">for</span> file in <span style="color:#a31515">`</span>find <span style="color:#a31515">${</span>PATH_TO_CODE<span style="color:#a31515">}</span> -type f -name <span style="color:#a31515">&#34;*.go&#34;</span> -not -path <span style="color:#a31515">&#34;*_test*&#34;</span><span style="color:#a31515">`</span>; <span style="color:#00f">do</span>
    list=<span style="color:#00f">$(</span>cat $file | grep -n <span style="color:#a31515">&#34;</span><span style="color:#a31515">${</span>WORD_TO_FIND<span style="color:#a31515">}</span><span style="color:#a31515">&#34;</span> | awk -F<span style="color:#a31515">&#39;:&#39;</span> <span style="color:#a31515">&#39;{print $1+1}&#39;</span><span style="color:#00f">)</span>

    <span style="color:#00f">if</span> [ ! -z <span style="color:#a31515">&#34;</span>$list<span style="color:#a31515">&#34;</span> ]; <span style="color:#00f">then</span>
        echo -e <span style="color:#a31515">&#34;\n</span>$file<span style="color:#a31515">&#34;</span>
        new_list=()
        <span style="color:#00f">for</span> line in <span style="color:#00f">$(</span>echo $list<span style="color:#00f">)</span>; <span style="color:#00f">do</span>
            metric=<span style="color:#00f">$(</span>cat $file | awk <span style="color:#a31515">&#34;(NR == </span>$line<span style="color:#a31515">)&#34;</span> | xargs echo | awk -F <span style="color:#a31515">&#39;,&#39;</span> <span style="color:#a31515">&#39;{print $1}&#39;</span><span style="color:#00f">)</span>
            <span style="color:#00f">if</span> [[ <span style="color:#a31515">&#34;</span>$metric<span style="color:#a31515">&#34;</span> =~ <span style="color:#a31515">&#34;desc&#34;</span> ]]; <span style="color:#00f">then</span>
                metric=<span style="color:#00f">$(</span>cat $file | grep <span style="color:#a31515">&#34;</span>$metric<span style="color:#a31515">.*=&#34;</span> | awk -F <span style="color:#a31515">&#34;=&#34;</span> <span style="color:#a31515">&#39;{print $2}&#39;</span> | xargs echo<span style="color:#00f">)</span>
            <span style="color:#00f">fi</span>
            new_list+=($metric)
        <span style="color:#00f">done</span>
        IFS=<span style="color:#a31515">$&#39;\n&#39;</span> sorted=(<span style="color:#00f">$(</span>sort -u &lt;&lt;&lt;<span style="color:#a31515">&#34;</span><span style="color:#a31515">${</span>new_list[*]<span style="color:#a31515">}</span><span style="color:#a31515">&#34;</span><span style="color:#00f">)</span>); unset IFS
        <span style="color:#00f">for</span> i in <span style="color:#a31515">${</span>sorted[@]<span style="color:#a31515">}</span>; <span style="color:#00f">do</span> echo $i; <span style="color:#00f">done</span>
    <span style="color:#00f">fi</span>
<span style="color:#00f">done</span>
</code></pre></div><p>Download metrics you can <a href="./ksm_230.txt">here</a>.</p>
<h2 id="diffrents">Diffrents</h2>
<p>As I sad above <code>1.7.0</code> is back compitable to <code>1.4.0</code>.</p>
<p><img src="./images/Screenshot_2022-02-24_at_18.50.04.png" alt="image"></p>
<p>But <code>2.3.0</code> is not back compitable to <code>1.4.0</code>.</p>
<p><img src="./images/Screenshot_2022-02-24_at_18.50.36.png" alt="image"></p>
<p>Deleted metrics in 2.3.0 from 1.4.0</p>
<ul>
<li>kube_pod_container_resource_limits_cpu_cores</li>
<li>kube_pod_container_resource_limits_memory_bytes</li>
<li>kube_pod_container_resource_requests_cpu_cores</li>
<li>kube_pod_container_resource_requests_memory_bytes</li>
<li>kube_hpa_labels</li>
<li>kube_hpa_metadata_generation</li>
<li>kube_hpa_spec_max_replicas</li>
<li>kube_hpa_spec_min_replicas</li>
<li>kube_hpa_status_condition</li>
<li>kube_hpa_status_current_replicas</li>
<li>kube_hpa_status_desired_replicas</li>
<li>kube_daemonset_updated_number_scheduled</li>
<li>kube_node_status_allocatable_cpu_cores</li>
<li>kube_node_status_allocatable_memory_bytes</li>
<li>kube_node_status_allocatable_pods</li>
<li>kube_node_status_capacity_cpu_cores</li>
<li>kube_node_status_capacity_memory_bytes</li>
<li>kube_node_status_capacity_pods</li>
<li>kube_node_status_phase</li>
</ul>
<p>To grep a directory for broken alerts use next construction:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">grep -nr <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_pod_container_resource_limits_cpu_cores <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_pod_container_resource_limits_memory_bytes <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_pod_container_resource_requests_cpu_cores <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_pod_container_resource_requests_memory_bytes <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_hpa_labels <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_hpa_metadata_generation <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_hpa_spec_max_replicas <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_hpa_spec_min_replicas <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_hpa_status_condition <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_hpa_status_current_replicas <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_hpa_status_desired_replicas <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_daemonset_updated_number_scheduled <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_node_status_allocatable_cpu_cores <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_node_status_allocatable_memory_bytes <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_node_status_allocatable_pods <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_node_status_capacity_cpu_cores <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_node_status_capacity_memory_bytes <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_node_status_capacity_pods <span style="color:#a31515">\
</span><span style="color:#a31515"></span>    -e kube_node_status_phase
</code></pre></div><h2 id="download-grafana-dashboards-to-check">Download Grafana Dashboards to check</h2>
<p>Usually Grafana keeps dashboards in a database. If dashboard files exist Grafana loads these in the start time.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">SERVER=<span style="color:#a31515">&#34;https://grafana.example.com&#34;</span>
LOGIN=login
PASS=password

<span style="color:#008000"># Load list</span>
<span style="color:#008000"># curl -H &#34;Content-Type: application/json&#34; -s &#34;${SERVER}/api/search&#34; -u ${LOGIN}:${PASS} | jq .</span>
LIST=<span style="color:#00f">$(</span>curl -H <span style="color:#a31515">&#34;Content-Type: application/json&#34;</span> -s <span style="color:#a31515">&#34;</span><span style="color:#a31515">${</span>SERVER<span style="color:#a31515">}</span><span style="color:#a31515">/api/search&#34;</span> -u <span style="color:#a31515">${</span>LOGIN<span style="color:#a31515">}</span>:<span style="color:#a31515">${</span>PASS<span style="color:#a31515">}</span> | jq <span style="color:#a31515">&#39;.[].uri&#39;</span> | xargs -L1 echo | awk -F <span style="color:#a31515">&#34;/&#34;</span> <span style="color:#a31515">&#39;{print $2}&#39;</span><span style="color:#00f">)</span>

<span style="color:#008000"># Save Dashboards to files</span>
mkdir ./tmp
<span style="color:#00f">for</span> i in <span style="color:#00f">$(</span>echo <span style="color:#a31515">${</span>LIST[@]<span style="color:#a31515">}</span><span style="color:#00f">)</span>; <span style="color:#00f">do</span>
    echo $i
    curl -H <span style="color:#a31515">&#34;Content-Type: application/json&#34;</span> -s <span style="color:#a31515">&#34;</span><span style="color:#a31515">${</span>SERVER<span style="color:#a31515">}</span><span style="color:#a31515">/api/dashboards/db/</span><span style="color:#a31515">${</span>i<span style="color:#a31515">}</span><span style="color:#a31515">&#34;</span> -u <span style="color:#a31515">${</span>LOGIN<span style="color:#a31515">}</span>:<span style="color:#a31515">${</span>PASS<span style="color:#a31515">}</span> | jq . &gt;&gt; ./tmp/<span style="color:#a31515">${</span>i<span style="color:#a31515">}</span>.json
<span style="color:#00f">done</span>
</code></pre></div><p>Based on <a href="https://serveradmin.ru/obnovlenie-grafana/">serveradmin.ru</a>.</p>
<p>After that can be used <code>grep</code> command that was defined above:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">grep -nr ... &gt; ./grafana-missed-metrics.txt

cat ./grafana-missed-metrics.txt | awk -F <span style="color:#a31515">&#34;./&#34;</span> <span style="color:#a31515">&#39;{print $2}&#39;</span> | awk -F <span style="color:#a31515">&#34;.json&#34;</span> <span style="color:#a31515">&#39;{print $1}&#39;</span> | sort -u
</code></pre></div><h2 id="fix-metrics">Fix metrics</h2>
<p>For example how to fix some metrics:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">kube_pod_container_resource_requests_cpu_cores
kube_pod_container_resource_requests{resource=&#34;cpu&#34;}

kube_pod_container_resource_limits_cpu_cores
kube_pod_container_resource_limits{resource=&#34;cpu&#34;}

kube_pod_container_resource_requests_memory_bytes
kube_pod_container_resource_requests{resource=&#34;memory&#34;}

kube_pod_container_resource_limits_memory_bytes
kube_pod_container_resource_limits{resource=&#34;memory&#34;}
</code></pre></div>
            </div>

            <div class="tags">
                 
                <ul class="flat">
                    
                    <li><a href="/tags/en">en</a></li>
                    
                    <li><a href="/tags/programming">programming</a></li>
                    
                    <li><a href="/tags/metrics">metrics</a></li>
                    
                </ul>
                 
            </div>

<br/>
<script defer src="https://commento.urpylka.com/js/commento.js" data-css-override="/css/commento.css"></script>
<div id="commento"></div>
<noscript>Please enable JavaScript to load the comments.</noscript></div>
    </div>
    <div class="footer wrapper">
	<nav class="nav">
		<div>2022  © Artem Smirnov |  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div><script>feather.replace()</script>
</body>

</html>