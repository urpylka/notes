<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><meta property="og:site_name" content="urpylka՚s blog!" data-vmid="og:site_name"><title>Заметка по работе с Bash – urpylka՚s blog!</title><meta property="og:title" content="Заметка по работе с Bash" />
<meta property="og:description" content="В общем накопилось достаточно большое количество периодически гуглящихся вещей, которые хочу сохранить в своей заметке." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://urpylka.com/posts/post-45/" />
<meta property="article:published_time" content="2020-04-16T02:14:00+04:00" />
<meta property="article:modified_time" content="2020-04-16T02:14:00+04:00" /><meta property="og:site_name" content="urpylka՚s blog!" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Заметка по работе с Bash"/>
<meta name="twitter:description" content="В общем накопилось достаточно большое количество периодически гуглящихся вещей, которые хочу сохранить в своей заметке."/>
<link rel="icon" type="image/x-icon" href="https://urpylka.com/favicon.ico" />
	<link rel="apple-touch-icon" sizes="57x57" href="https://urpylka.com/favicon/apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="https://urpylka.com/favicon/apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="https://urpylka.com/favicon/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="https://urpylka.com/favicon/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="https://urpylka.com/favicon/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="https://urpylka.com/favicon/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="https://urpylka.com/favicon/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="https://urpylka.com/favicon/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="https://urpylka.com/favicon/apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192"  href="https://urpylka.com/favicon/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://urpylka.com/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="https://urpylka.com/favicon/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://urpylka.com/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://urpylka.com/favicon/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="https://urpylka.com/favicon/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1"><meta itemprop="name" content="Заметка по работе с Bash">
<meta itemprop="description" content="В общем накопилось достаточно большое количество периодически гуглящихся вещей, которые хочу сохранить в своей заметке.">
<meta itemprop="datePublished" content="2020-04-16T02:14:00&#43;04:00" />
<meta itemprop="dateModified" content="2020-04-16T02:14:00&#43;04:00" />
<meta itemprop="wordCount" content="616">



<meta itemprop="keywords" content="ru,programming,linux,cheatsheet," /><link rel="stylesheet" type="text/css" media="screen" href="https://urpylka.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://urpylka.com/css/main.css" />
	<link rel="stylesheet" type="text/css" id="dark-scheme" href="https://urpylka.com/css/dark.css" />
	<link rel="stylesheet" type="text/css" href="https://urpylka.com/css/medium-font.css" />
<script type="text/javascript" >
	(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
	m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
	(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
ym("62022457", "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/62022457" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-163829261-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	<script src="https://urpylka.com/js/feather.min.js"></script><script src="https://urpylka.com/js/main.js"></script></head>


<body>
    <div class="container wrapper">
        <div class="header"><div class="flex-block">
		<div class="site-title"><a href="https://urpylka.com/">urpylka՚s blog!</a></div>
		<nav class="nav ico">
			<ul class="flat"><li><a href="https://github.com/urpylka" title="Github"><i data-feather="github"></i></a></li><li><a href="https://instagram.com/urpylka" title="Instagram"><i data-feather="instagram"></i></a></li><li class="edge-left"><span class="scheme-toggle"><a href="#" id="scheme-toggle"></a></span></li>
			</ul>
		</nav>
	</div><p id="subtitle">Programming, electronics, lifestyle</p><nav class="nav menu">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">Posts</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


        <div class="post one">
            <div class="post-header">
                
                <div class="meta">
                    <div class="date">
                        <span class="day">16</span>
                        <span class="rest">Apr 2020</span>
                    </div>
                </div>
                
                <div class="matter">
                    <h1 class="title">Заметка по работе с Bash</h1>
                </div>
            </div>

            <div class="markdown">
                <p>У меня накопилось достаточно большое количество переодически гуглящихся вещей, которые хочу сохранить в этой заметке. Заметка будет обновляться по мере того, как часто я с ней буду работать.</p>
<h2 id="bash">Bash</h2>
<h3 id="перенаправления-и-pipe">Перенаправления и pipe</h3>
<p><code>|</code> - передача аргумента<br>
<code>&gt;</code> – передача вывода команды в новый файл или перезапись существующего файла<br>
<code>&gt;&gt;</code> - передача вывода команды в новый файл или дозапись с конца</p>
<p>Стандартный вывод команды происходит с числом <code>1</code>, вывод ошибок с числом <code>2</code>. Выводы перенаправлять в разные файлы отдельно.</p>
<p><code>2&gt;&amp;1</code> – перенаправляет вывод ошибки на стандартный вывод, поэтому они появляются вместе и могут быть совместно перенаправлены в файл.<br>
<code>2&gt;1</code> – перенаправит вывод ошибки в файл с именем <code>1</code>, а не в стандартный вывод <code>1</code>.</p>
<p>Источники:</p>
<ul>
<li><a href="https://unix.stackexchange.com/questions/89386/what-is-symbol-and-in-unix-linux">what is &raquo; symbol and &gt;&amp; in unix/Linux? [duplicate]</a></li>
<li><a href="https://www.linux.org.ru/forum/general/13119156">bash разница между &raquo; и |</a></li>
<li><a href="https://habr.com/ru/company/ruvds/blog/326594/">Bash-скрипты, часть 4: ввод и вывод</a></li>
</ul>
<h3 id="параллельно-исполнение-в-bash">Параллельно исполнение в Bash</h3>
<p><code>nohup</code> - запускает с игнорирование потери связи с пользователем (при выходе пользователя из системы все будет продолжаться в фоновом режиме)</p>
<p>Источники:</p>
<ul>
<li><a href="http://web.archive.org/web/20140226042820/http://user.hashcode.ru/questions/4573/bash-%D0%B2%D0%BE%D0%B7%D0%BC%D0%BE%D0%B6%D0%BD%D0%BE-%D0%BB%D0%B8-%D0%B2-linux-%D0%BF%D0%B0%D1%80%D0%B0%D0%BB%D0%BB%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D0%B2%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5-sh-%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D0%B0">bash - Возможно ли в Linux параллельное выполнение .sh скрипта?</a></li>
<li><a href="https://mnorin.com/parallelnoe-vypolnenie-v-bash.html">Параллельное выполнение в bash</a></li>
</ul>
<h3 id="полезные-ссылки">Полезные ссылки</h3>
<ul>
<li>Изменение значения окружения указывающей на разделение списка <a href="http://www.f-notes.info/linux:bash_lists">f-notes.info</a></li>
<li>Хороший справочник по встроенным командам bash <a href="https://losst.ru/osnovnye-komandy-bash">losst.ru</a></li>
<li>bash awk <a href="https://habrahabr.ru/company/ruvds/blog/327754/">habr.ru</a></li>
<li>bash uniq (удаление повторов строк) <a href="https://www.linux.org.ru/forum/general/7476629">linux.org.ru</a></li>
<li>разница return and exit <a href="https://stackoverflow.com/questions/4419952/difference-between-return-and-exit-in-bash-functions">stackoverflow</a></li>
<li>Вывод echo \r <a href="https://losst.ru/komanda-echo-v-linux">losst.ru</a></li>
<li>переменные окружения <code>env</code>, <code>$SHELL</code>, <code>$EDITOR</code> <a href="http://unix1.jinr.ru/~lavr/howtostart.html">unix1.jinr.ru</a></li>
<li>firewall gui centos – <code>system-config-firewall</code></li>
</ul>
<h3 id="отладка-программ">Отладка программ</h3>
<ul>
<li><code>strace</code> - системные вызовы</li>
<li><code>ltrace</code> - трейсить вызовы из SO</li>
<li><code>ldd</code> - посмотреть зависимые библиотеки</li>
</ul>
<h3 id="пакетный-менеджер-apt-и-dpkg">Пакетный менеджер apt и dpkg</h3>
<ul>
<li><a href="https://system-admins.ru/kak-otkatit-obnovleniya-na-debian-ubuntu-linux-v-sluchae-problem/">Как откатить обновления на Debian / Ubuntu Linux в случае проблем</a></li>
<li><a href="http://web.archive.org/web/20170505152409/http://www.stanovlenie.org.ua/download-the-deb-packages-with-dependencies-for-offline-installation/">Скачиваем deb-пакеты с зависимостями для offline-установки.</a></li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#008000"># Мощное удаление всего что можно APT</span>
sudo apt-get remove lxde-common lxde-icon-theme omxplayer x11-common midori lxde python3 python3-minimal

<span style="color:#008000"># Удаление всех файлов связанных с `x11`</span>
sudo apt-get remove <span style="color:#00f">$(</span>sudo dpkg --get-selections | grep -v <span style="color:#a31515">&#34;deinstall&#34;</span> | grep x11 | sed s/install//<span style="color:#00f">)</span>

<span style="color:#008000"># Удаление всех файлов связанных с `audio`</span>
sudo apt-get remove <span style="color:#00f">$(</span>sudo dpkg --get-selections | grep -v <span style="color:#a31515">&#34;deinstall&#34;</span> | grep audio | sed s/install//<span style="color:#00f">)</span>

<span style="color:#008000"># Удаление неиспользуемых пакетов</span>
sudo apt-get autoremove
</code></pre></div><p>Управление установленными репозиториями – файл <code>/etc/apt/sources.list</code></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#008000"># Посмотреть какому пакету принадлежит файл</span>
sudo dpkg -S FILE

<span style="color:#008000"># Посмотреть какие файлы принадлежат пакету</span>
sudo dpkg -L ros-kinetic-catkin
</code></pre></div><h3 id="проверка-версии-debian">Проверка версии Debian</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat /etc/os-release
lsb_release -a
</code></pre></div><p><img src="./assets/screenshot-2017-09-01-v-1.54.17.png" alt="image"></p>
<h3 id="копирование-с-exclude">Копирование с exclude</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">rsync -av --progress * --exclude sakis_install.sh
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo cp -r * -i sakis_install.sh
</code></pre></div><h3 id="поиск">Поиск</h3>
<ul>
<li>Поиск по содержимому grep <a href="https://losst.ru/gerp-poisk-vnutri-fajlov-v-linux">losst.ru/gerp-poisk-vnutri-fajlov-v-linux</a></li>
<li>Поиск по файлам find <a href="https://losst.ru/komanda-find-v-linux">losst.ru/komanda-find-v-linux</a></li>
</ul>
<h3 id="добавление-прав-для-выполнения-sudo">Добавление прав для выполнения sudo</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">usermod -a -G sudo artem
</code></pre></div><h3 id="настройка-сети-ubuntu-server">Настройка сети ubuntu server</h3>
<ul>
<li><a href="https://losst.ru/nastrojka-seti-iz-konsoli-ubuntu">https://losst.ru/nastrojka-seti-iz-konsoli-ubuntu</a></li>
<li><a href="https://theintobooks.wordpress.com/2016/03/03/installing-qemu-on-mac-os-x-el-capitan/">https://theintobooks.wordpress.com/2016/03/03/installing-qemu-on-mac-os-x-el-capitan/</a></li>
</ul>
<h3 id="очистить-history">Очистить history</h3>
<ul>
<li><a href="https://askubuntu.com/questions/191999/how-to-clear-bash-history-completely">https://askubuntu.com/questions/191999/how-to-clear-bash-history-completely</a></li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat /dev/null &gt; ~/.bash_history &amp;&amp; history -c &amp;&amp; exit
</code></pre></div><h3 id="screen">Screen</h3>
<ul>
<li><a href="https://stackoverflow.com/questions/19104894/screen-must-be-connected-to-a-terminal/25646444">Screen &ldquo;Must be connected to a Terminal&rdquo;</a></li>
<li><a href="https://admins.su/kak-polzovatsya-utilitoj-screen-v-linux/">Как пользоваться утилитой Screen в Linux</a></li>
</ul>
<h3 id="unconfigure">Unconfigure</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">virt-sysprep
virt-configure
</code></pre></div><h3 id="название-вкладки">Название вкладки</h3>
<p><img src="./assets/screenshot-2017-11-15-v-13.48.57.png" alt="image"></p>
<h2 id="работа-с-логами">Работа с логами</h2>
<ul>
<li>
<p>выборка</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">grep &#39;Aug  8 16:&#39; aug8_daemon.log  &gt; aug8_16hour_daemon.log
</code></pre></div></li>
<li>
<p>работа с grep <a href="komandi-na-zametku.md">admins.su/grep-nezamenimyj-instrument-linuksoida/</a></p>
</li>
</ul>
<h3 id="logrotate-in-ros">Logrotate in ROS</h3>
<ul>
<li><a href="https://answers.ros.org/question/267503/log-rotation-in-ros/">answers.ros.org/question/267503/log-rotation-in-ros/</a></li>
<li><a href="https://github.com/mikepurvis/ros-system-daemon/blob/master/debian/ros-system-daemon.ros.logrotate">github.com/mikepurvis/ros-system-daemon/blob/master/debian/ros-system-daemon.ros.logrotate</a></li>
<li><a href="https://askubuntu.com/questions/847790/why-is-logrotate-not-running-automatically">askubuntu.com/questions/847790/why-is-logrotate-not-running-automatically</a></li>
<li><a href="https://www.opennet.ru/base/sys/logrotate_howto.txt.html">opennet.ru/base/sys/logrotate_howto.txt.html</a></li>
<li><a href="https://stackoverflow.com/questions/25485047/hourly-rotation-of-files-using-logrotate">stackoverflow.com/questions/25485047/hourly-rotation-of-files-using-logrotate</a></li>
</ul>
<h2 id="ros-переполнение-логов">ROS: Переполнение логов</h2>
<p>Стандартная утилита для мониторинга и чистки <a href="http://wiki.ros.org/rosclean">http://wiki.ros.org/rosclean</a>
<a href="https://answers.ros.org/question/258978/is-there-an-alternative-way-to-get-rid-of-ros-log-files/">https://answers.ros.org/question/258978/is-there-an-alternative-way-to-get-rid-of-ros-log-files/</a></p>
<p><img src="./assets/screenshot-2017-09-12-v-14.58.30.png" alt="image"></p>
<p><img src="./assets/screenshot-2017-09-12-v-16.13.44.png" alt="image"></p>
<blockquote>
<p>Переполнение логов 20 метров (то, что я сохранил)
<a href="./assets/cecd58fa-972b-11e7-ad41-3974d4b0fb26.zip">.ros/log/cecd58fa-972b-11e7-ad41-3974d4b0fb26</a></p>
</blockquote>
<p>Скрипт очистки логов, если накопилось более 300MB</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">if [[ $(du -s .ros | awk &#39;{ print $1 }&#39;) -ge 300000 ]]; then yes | rosclean purge; echo &#34;urpylka: cleaned ros log&#34;; fi
</code></pre></div><h2 id="macos">macOS</h2>
<h3 id="смена-ttl-на-macos">Смена TTL на macOS</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">sudo sysctl -w net.inet.ip.ttl=65
</code></pre></div><h3 id="resize-volume-on-macos">Resize volume on macos</h3>
<ul>
<li><a href="https://apple.stackexchange.com/questions/197640/diskutil-resizevolume-noob">apple.stackexchange.com/questions/197640/diskutil-resizevolume-noob</a></li>
<li><a href="https://www.macworld.com/article/1055274/software-utilities/marchgeekfactor.html">macworld.com/article/1055274/software-utilities/marchgeekfactor.html</a></li>
</ul>
<h3 id="losetup-macos">losetup macos</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">hdiutil attach build_server_backup.img
</code></pre></div><p><a href="https://ctrld.me/blog/2009/10/03/rabotaem-s-obrazami-diskov-v-terminal-app-hdiutil/">ctrld.me/blog/2009/10/03/rabotaem-s-obrazami-diskov-v-terminal-app-hdiutil/</a></p>
<h3 id="монитрование-файловых-систем-ext2-ext3-ext4">Монитрование файловых систем ext2, ext3, ext4</h3>
<ul>
<li><a href="https://github.com/alperakcan/fuse-ext2">github.com/alperakcan/fuse-ext2</a></li>
<li>brew ext <a href="https://github.com/gerard/ext4fuse">github.com/gerard/ext4fuse</a></li>
</ul>
<h3 id="работа-с-маршрутами">Работа с маршрутами</h3>
<ul>
<li><a href="http://did5.ru/apple/macos-apple/kak-posmotret-dobavit-i-udalit-marshrut-v-mac-os-x.html">Как посмотреть, добавить и удалить маршрут в Mac OS X</a></li>
<li><a href="https://www.tunnelsup.com/how-to-see-the-routing-table-on-mac-osx/">How to See the Routing Table on Mac OSX</a></li>
<li><a href="https://td.unh.edu/TDClient/60/Portal/KB/ArticleDet?ID=784">How-To: Route Print (Mac OS X) </a></li>
<li><a href="https://gist.github.com/taldanzig/4628573">Routing tips for VPNs on OS X</a></li>
</ul>
<h3 id="использования-мака-в-качестве-монитора">Использования мака в качестве монитора</h3>
<p><a href="https://support.apple.com/en-us/ht204592">support.apple.com/en-us/ht204592</a></p>
<h2 id="неразрывные-символы">Неразрывные символы</h2>
<ul>
<li><a href="https://unicode-table.com/ru/2011/">неразрыный дефис</a> «‑»</li>
<li><a href="https://ru.wikipedia.org/wiki/%D0%9D%D0%B5%D1%80%D0%B0%D0%B7%D1%80%D1%8B%D0%B2%D0%BD%D1%8B%D0%B9_%D0%BF%D1%80%D0%BE%D0%B1%D0%B5%D0%BB">неразрывный пробел</a>. Неразрывные пробелы есть разной длины, « » – стандартный. Другие можно найти по ссылке.</li>
</ul>
<h2 id="сброс-ttl">Сброс TTL</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo iptables -t mangle -A POSTROUTING -j TTL --ttl-set 65
</code></pre></div>
            </div>

            <div class="tags">
                 
                <ul class="flat">
                    
                    <li><a href="/tags/ru">ru</a></li>
                    
                    <li><a href="/tags/programming">programming</a></li>
                    
                    <li><a href="/tags/linux">linux</a></li>
                    
                    <li><a href="/tags/cheatsheet">cheatsheet</a></li>
                    
                </ul>
                 
            </div>

</div>
    </div>
    <div class="footer wrapper">
	<nav class="nav">
		<div>2020  © Artem Smirnov |  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div><script>feather.replace()</script>
</body>

</html>